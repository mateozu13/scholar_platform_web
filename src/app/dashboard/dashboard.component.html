<mat-toolbar color="primary" class="toolbar">
  <span class="title">Configuración de Perfil</span>
  <span class="spacer"></span>
  <button mat-icon-button routerLink="/dashboard" matTooltip="Dashboard">
    <mat-icon>dashboard</mat-icon>
  </button>
  <button mat-icon-button routerLink="/users" matTooltip="Usuarios">
    <mat-icon>people</mat-icon>
  </button>
  <button mat-icon-button routerLink="/courses" matTooltip="Cursos">
    <mat-icon>school</mat-icon>
  </button>
  <button mat-icon-button routerLink="/settings" matTooltip="Configuración">
    <mat-icon>settings</mat-icon>
  </button>
  <button mat-icon-button (click)="logout()" matTooltip="Salir">
    <mat-icon>logout</mat-icon>
  </button>
</mat-toolbar>

<div class="dashboard-container">
  <!-- Tarjetas de resumen -->
  <div class="summary-cards">
    <mat-card class="summary-card">
      <mat-card-title>Total de cursos</mat-card-title>
      <mat-card-content>{{ totalCourses }}</mat-card-content>
    </mat-card>
    <mat-card class="summary-card">
      <mat-card-title>Total de usuarios</mat-card-title>
      <mat-card-content>
        Admin: {{ userCounts.admin }}, Profesor: {{ userCounts.profesor }},
        Estudiante: {{ userCounts.estudiante }}
      </mat-card-content>
    </mat-card>
    <mat-card class="summary-card">
      <mat-card-title>Entregas tardías</mat-card-title>
      <mat-card-content>{{ lateSubmissionsCount }}</mat-card-content>
    </mat-card>
    <mat-card class="summary-card">
      <mat-card-title>Mensajes (promedio diario 7 días)</mat-card-title>
      <mat-card-content>{{ avgMessagesPerDay7d }}</mat-card-content>
    </mat-card>
  </div>

  <!-- Gráficas -->
  <div class="chart-grid">
    <mat-card class="chart-card">
      <mat-card-title>Usuarios por rol</mat-card-title>
      <canvas baseChart [data]="rolesPieData" [type]="'pie'"></canvas>
    </mat-card>
    <mat-card class="chart-card">
      <mat-card-title>Estudiantes por curso</mat-card-title>
      <canvas baseChart [data]="studentsBarData" [type]="'bar'"></canvas>
    </mat-card>
    <mat-card class="chart-card">
      <mat-card-title>Entregas vs Pendientes</mat-card-title>
      <canvas
        baseChart
        [data]="tasksStackedData"
        [options]="tasksStackedOptions"
        [type]="'bar'"
      ></canvas>
    </mat-card>
    <mat-card class="chart-card">
      <mat-card-title>Promedio de calificaciones por curso</mat-card-title>
      <canvas baseChart [data]="gradesBarData" [type]="'bar'"></canvas>
    </mat-card>
    <mat-card class="chart-card">
      <mat-card-title>Mensajes últimos 7 días</mat-card-title>
      <canvas
        baseChart
        [data]="messagesLineData"
        [options]="messagesLineOptions"
        [type]="'line'"
      ></canvas>
    </mat-card>
  </div>

  <!-- Listas de detalle -->
  <div class="list-cards">
    <mat-card>
      <mat-card-title>Top 5 cursos con más estudiantes</mat-card-title>
      <mat-list>
        <mat-list-item *ngFor="let course of topCourses">
          {{ course.titulo }} - {{ course.estudiantesCount }} estudiantes
        </mat-list-item>
      </mat-list>
    </mat-card>
    <mat-card>
      <mat-card-title>Últimos 5 usuarios logueados</mat-card-title>
      <mat-list>
        <mat-list-item *ngFor="let user of recentUsers">
          {{ user.nombre }} ({{ user.rol }}) - Último acceso:
          {{ formatDate(user.lastLogin) }}
        </mat-list-item>
      </mat-list>
    </mat-card>
  </div>
</div>
